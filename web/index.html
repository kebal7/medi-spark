<!DOCTYPE html>
<html>
<head>
    <title>Heart Disease Predictor</title>
</head>
<body>
    <h2>Heart Disease Prediction</h2>
    <form id="predictForm">
        Age: <input type="number" name="age" required><br>

        Sex: 
        <select name="sex" required>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select><br>

        Chest Pain Type: 
        <select name="cp" required>
            <option value="typical angina">typical angina</option>
            <option value="atypical angina">atypical angina</option>
            <option value="non-anginal">non-anginal</option>
            <option value="asymptomatic">asymptomatic</option>
        </select><br>

        Resting BP (mm Hg): <input type="number" name="trestbps" required><br>
        Cholesterol (mg/dl): <input type="number" name="chol" required><br>
        Fasting Blood Sugar (mg/dl): <input type="number" name="fbs" required><br>

        Max Heart Rate Achieved: <input type="number" name="thalach" required><br>

        Exercise Induced Angina: 
        <select name="exang" required>
            <option value="True">True</option>
            <option value="False">False</option>
        </select><br>

        Oldpeak: <input type="number" step="0.1" name="oldpeak" required><br>

        Slope of ST Segment: 
        <select name="slope" required>
            <option value="upsloping">upsloping</option>
            <option value="flat">flat</option>
            <option value="downsloping">downsloping</option>
        </select><br>

        Major Vessels (0-3): <input type="number" name="ca" min="0" max="3" required><br>

        Thalassemia: 
        <select name="thal" required>
            <option value="normal">normal</option>
            <option value="fixed defect">fixed defect</option>
            <option value="reversible defect">reversible defect</option>
        </select><br><br>

        <button type="submit">Predict</button>
        <button type="button" id="randomFill">Random Fill</button>
    </form>

    <h3 id="result"></h3>

    <script>
        const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const randomFloat = (min, max, step=0.1) => +(Math.random() * (max - min) + min).toFixed(1);
        const pickRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];

        document.getElementById("predictForm").onsubmit = async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            // Convert exang to boolean
            data.exang = data.exang === "True";

            const response = await fetch("/predict", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(data)
            });

            const result = await response.json();
            document.getElementById("result").innerText = 
              "Prediction: " + result.prediction + 
              " (" + result.risk_level + " Risk)\n" +
              "Probability of Heart Disease: " + result.probability_disease + "%\n" +
              "Probability of No Heart Disease: " + result.probability_no_disease + "%";
        };

        // Random fill button
        document.getElementById("randomFill").onclick = function() {
            const form = document.getElementById("predictForm");
            form.age.value = randomInt(29, 77); // typical age range
            form.sex.value = pickRandom(["Male", "Female"]);
            form.cp.value = pickRandom(["typical angina","atypical angina","non-anginal","asymptomatic"]);
            form.trestbps.value = randomInt(90, 180);
            form.chol.value = randomInt(150, 350);
            form.fbs.value = randomInt(70, 200); // mg/dl
            form.thalach.value = randomInt(90, 200);
            form.exang.value = pickRandom(["True", "False"]);
            form.oldpeak.value = randomFloat(0, 6);
            form.slope.value = pickRandom(["upsloping","flat","downsloping"]);
            form.ca.value = randomInt(0, 3);
            form.thal.value = pickRandom(["normal","fixed defect","reversible defect"]);
        };
    </script>
</body>
</html>

